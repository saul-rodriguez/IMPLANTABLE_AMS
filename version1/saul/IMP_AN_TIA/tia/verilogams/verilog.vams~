//Verilog-AMS HDL for "IMP_AN_TIA", "tia" "verilogams"

`include "constants.vams"
`include "disciplines.vams"

module tia ( voutn, voutp, Gain, Iinn, Iinp, bias_in, vdda, vssa, vsub );

  output voutp;
  output voutn;
  input vsub;
  input Iinn;
  input vdda;
  input bias_in;
  input Iinp;
  input vssa;
  input Gain;

  logic Gain;
  electrical voutn, voutp, Iinn, Iinp, vssa;

  
  parameter real vcm = 0.9 ;

  real RF = 1.5e6;
  real vdif;

  //Digital part
  always @(Gain)
  begin
	if (Gain == 0) begin // High Gain, RF = 1.5M
 		RF = 1.5e6;
	end else begin // Low Gain RF = 500k
		RF = 500.0e3;
	end
  end

  //Analog part
  analog begin

  	vdif = -10000*V(Iinp,Iinn);

	//Set the common mode	
	V(voutp,vssa) <+ vdif/2 + vcm;
	V(voutn,vssa) <+ -vdif/2 + vcm;

    //Transimpedance amplifier
    I(Iinp,voutn) <+ V(Iinp,voutn)/(RF/2);
    I(Iinn,voutp) <+ V(Iinn,voutp)/(RF/2);


  end



endmodule
